<!DOCTYPE html>
<html>
	<head>
		<script type="text/javascript" src="src/main/js/vps.Utils.js"></script>
		<script type="text/javascript" src="src/main/js/vps.GeometryUtils.js"></script>
		<script type="text/javascript" src="src/main/js/vps.Coord2d.js"></script>
		<script type="text/javascript" src="src/main/js/vps.Coord3d.js"></script>
		<script type="text/javascript" src="src/main/js/vps.Vector3d.js"></script>
		<script type="text/javascript" src="src/main/js/vps.Rotation.js"></script>
		<script type="text/javascript" src="src/main/js/vps.TransformationMatrix.js"></script>
		<script type="text/javascript" src="src/main/js/vps.RotationTransformationMatrix.js"></script>
		<script type="text/javascript" src="src/main/js/vps.RotationTransformationFactory.js"></script>
		<script type="text/javascript" src="src/main/js/vps.TranslationTransformationMatrix.js"></script>
		<script type="text/javascript" src="src/main/js/vps.Polygon.js"></script>
		<script type="text/javascript" src="src/main/js/vps.Vertex.js"></script>
		<script type="text/javascript" src="src/main/js/vps.Polygon3.js"></script>
		<script type="text/javascript" src="src/main/js/vps.Polygon4.js"></script>
		<script type="text/javascript" src="src/main/js/vps.ObjectManager.js"></script>
		<script type="text/javascript" src="src/main/js/vps.WorldObject.js"></script>
		<script type="text/javascript" src="src/main/js/vps.worldobjects.Cube.js"></script>
		<script type="text/javascript" src="src/main/js/vps.worldobjects.Coriolis.js"></script>
	</head>
	<body>
		<canvas id="canvas" height="500" width="500" style="background-color: black;"></canvas>
		<textarea rows="5" cols="20" id="fps"></textarea>
		<script>
			var canvas = document.querySelector('canvas');
			var ctx = canvas.getContext('2d');
			ctx.strokeStyle = "#ffffff";
			ctx.lineCap = "butt";
			ctx.lineJoin = "round";
			
			var oneDegree = Math.PI/180;	
			var objectManager = new vps.ObjectManager();
			
			for (var i=-1600; i<1600; i+=800){
				for(var j=-1600; j<1600; j+=800){
					for(var k=-1600; k<1600; k+=800){
						var cube1 = new vps.worldobjects.Coriolis('coriolis_'+i+'_'+j+'_'+k);
						cube1.rotation = new vps.Rotation(0,0,0);
						cube1.rotationSpeed = new vps.Rotation(0, oneDegree, 0);
						cube1.position = new vps.Coord3d(j,k,i);
						objectManager.addObject(cube1);
					}		
				}
			}
			
			//var cube1 = new vps.worldobjects.Cube('coriolis');
			//cube1.rotation = new vps.Rotation(0,0,0);
			//cube1.rotationSpeed = new vps.Rotation(0, oneDegree, 0);
			//cube1.position = new vps.Coord3d(0,0,0);
			//objectManager.addObject(cube1);

			var cameraPosition = new vps.Coord3d(0,0,-1000);
			var cameraRotation = new vps.Rotation(0,0,0);
			
			var viewerPosition = new vps.Coord3d(-20,0,0);	
			
			
			// This is the body of the 'game loop'
			var updateAndDraw = function () {

				objectManager.updateAll(cameraPosition, cameraRotation, viewerPosition);
				objectManager.drawAll(ctx);

			};
			
			// Calculate FPS every second
			var fpsOut = document.getElementById('fps');
			setInterval(function(){
			  
				var fps = objectManager.fps.toFixed(1);
				fpsOut.value = fps;
			  
			}, 2000); 
			
			// Update screen 30x per second
			window.setInterval(function(){
				ctx.clearRect(0, 0, 500, 500);
				updateAndDraw();
			},30);
			
			
			document.onkeyup=(function(e){
				var key=(typeof event!='undefined')?window.event.keyCode:e.keyCode;
	
				// Turning left and right
				if(key==39){
					cameraRotation.y -= oneDegree;
				}
				if(key==37){
					cameraRotation.y += oneDegree;
				}
				
				// Looking up and down
				if(key==38){
					cameraRotation.x += oneDegree;
				}
				if(key==40){
					cameraRotation.x -= oneDegree;
				}
				
				// Move the camera in the direction it's facing
				if(key==65){
					vps.GeometryUtils.moveInFacingDirection(cameraPosition, cameraRotation, 100);		
				}
				if(key==90){
					vps.GeometryUtils.moveInFacingDirection(cameraPosition, cameraRotation, -100);		
				}
				console.log('Camera position is '+cameraPosition);

			});
			
		</script>
		
		
			
	</body>
</html>